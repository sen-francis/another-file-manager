<!DOCTYPE html>
<html>

<head>
  <style>
    h1 {
      text-align: center;
    }

    h2 {
      text-align: center;
    }

    div {
      text-align: center;
    }
  </style>
  <title>Another File Manager</title>
</head>

<body>
  <div class="startPage" id="startPageID">
    <h1>Welcome to Another File Manager!</h1>
    <h2>Select a Folder to Begin Cleaning</h2>
    <div class="file-dialog">
      <input id="inputID" type="file" webkitdirectory directory multiple>
      <br>
      <button id="nextButtonID" onclick="nextFunction()">Next</button>
    </div>
    <!-- You can also require other files to run in this process -->
    <script type="text/javascript">
      function nextFunction() {
        if (document.getElementById("inputID").value != "") {
          // directory selected
          // set filepath as next page header
          // [PROBLEM] : current path: "d/..." -> expected path: "D:/..."
          var fileName = document.getElementById("inputID").files[0].path;
          var filePath = fileName.substring(0, fileName.lastIndexOf("/"));
          document.getElementById("headerID").innerHTML = "Current Folder: " + filePath;
          // open query page
          document.getElementById("startPageID").style.display = "none";
          document.getElementById("searchQueryID").style.display = "block";
        }
        else {
          //directory not selected
          alert("ERROR! Please select a directory before continuing.");
        }
      }
    </script>
  </div>

  <div class="searchQuery" id="searchQueryID" style="display:none">
    <h2 id="headerID">Current Folder: </h2>
    <h2 id="tmpID">Select Search Criteria</h2>
    <div class="search-criteria">
      <div class="date-created">
        <input type="checkbox" id="createdCheckboxID" name="createdCheckbox" value="createdChecked">
        <label for="createdCheckbox">Date Created</label> <br>
        <label for="createdFromDate">From: </label>
        <input type="date" id="createdFromDateID" name="createdFromDate"> <br>
        <label for="createdToDate">To: </label>
        <input type="date" id="createdToDateID" name="createdToDate">
      </div>
      <div class="date-modified">
        <input type="checkbox" id="modifiedCheckboxID" name="modifiedCheckbox" value="modifiedChecked">
        <label for="modifiedCheckbox">Date Modified</label> <br>
        <label for="modifiedFromDate">From: </label>
        <input type="date" id="modifiedFromDateID" name="modifiedFromDate"> <br>
        <label for="modifiedToDate">To: </label>
        <input type="date" id="modifiedToDateID" name="modifiedToDate">
      </div>
      <script type="text/javascript">
        createdFromDateID.max = new Date().toISOString().split("T")[0];
        createdToDateID.max = new Date().toISOString().split("T")[0];
        modifiedFromDateID.max = new Date().toISOString().split("T")[0];
        modifiedToDateID.max = new Date().toISOString().split("T")[0];
      </script>
      <button onclick="resultsPageLoad()">Search</button>
    </div>
    <script>
      function resultsPageLoad() {
        //alert("pre-require");
        var worker = new Worker("./tmp.js");
        //alert("post worker");
        /*// should we use cpp to find files matching criteria???
        const backend = require("./build/Release/backend.node");
        var createdFromDate = "NULL";
        var createdToDate = "NULL";
        var modifiedFromDate = "NULL";
        var modifiedToDate = "NULL";
        alert("post reuqior");
        // Parse dates into MM/DD/YYYY strings
        if(document.getElementById("createdCheckbox").checked == true){
          //check if user does not pick date (call alert)
          var tmpCreatedFromDate = new Date(document.getElementById("createdCheckbox").value);
          // might have to increment month seperately in var
          createdFromDate = tmpCreatedFromDate.getMonth()+1 + "/" + tmpCreatedFromDate.getDate() + "/" + tmpCreatedFromDate.getFullYear();

          var tmpCreatedToDate = new Date(document.getElementById("createdCheckbox").value);
          createdToDate = tmpCreatedToDate.getMonth()+1 + "/" + tmpCreatedToDate.getDate() + "/" + tmpCreatedToDate.getFullYear();
        }

        if(document.getElementById("modifiedCheckbox").checked == true){
          var tmpModifiedFromDate = new Date(document.getElementById("modifiedCheckbox").value);
          modifiedFromDate = tmpModifiedFromDate.getMonth()+1 + "/" + tmpModifiedFromDate.getDate() + "/" + tmpModifiedFromDate.getFullYear();

          var tmpModifiedToDate = new Date(document.getElementById("modifiedCheckbox").value);
          modifiedToDate = tmpModifiedToDate.getMonth()+1 + "/" + tmpModifiedToDate.getDate() + "/" + tmpModifiedToDate.getFullYear();
        }
        var fileName = document.getElementById("inputID").files[0].path;
        var filePath = fileName.substring(0, fileName.lastIndexOf("/"));

        alert("got here");
        var tmpArr = backend.search(filePath,createdFromDate,createdToDate,modifiedFromDate,modifiedToDate);
        alert("and here");
        tmpArr.forEach(element => alert(element));
        alert("not here");
        worker.onmessage = function(event) { 
          event.data.forEach(element => alert(element));
          alert(event.data);
          alert("HELLO");
        }
        worker.onerror = function (event) {
          console.log(event.message, event);
        };*/
        // Displays next screen
        worker.terminate();
        //document.getElementById("searchQueryID").style.display = "none";
        //document.getElementById("searchResultsID").style.display = "block";
        alert("????");
      }
    </script>
  </div>

  <div class="searchResults" id="searchResultsID" style="display:none">
    <h1>Files Found</h1>
    <div class="files">
      <button onclick="finalPageLoad()">Confirm Deletion</button>
    </div>
    <script>
      function finalPageLoad() {
        document.getElementById("searchResultsID").style.display = "none";
        document.getElementById("finalPageID").style.display = "block";
      }
    </script>
  </div>

  <div class="finalPage" id="finalPageID" style="display:none">
    <h1>Files Deleted Succesfully!</h1>
    <h2>Files can be found in Recycling Bin in a folder named </h2>
    <h2>Be sure to delete the files after review!</h2>
    <div>
      <button onclick="startPageLoad()">Clean New Folder</button>
    </div>
    <script>
      function startPageLoad() {
        document.getElementById("finalPageID").style.display = "none";
        document.getElementById("startPageID").style.display = "block";
        //window.location.reload();
        //var remote = require('remote');
        //remote.getCurrentWindow().reload();
        // refresh page so previous selection does not show...
      }
    </script>
  </div>

</body>

</html>